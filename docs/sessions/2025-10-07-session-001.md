Session 001 - October 7, 2025

Objectives

- ✅ Assess cluster health
- ✅ Troubleshoot degraded operators
- ✅ Fix DNS configuration
- ✅ Establish console access

Work Performed

1. Cluster Health Assessment

Initial Status:
oc get clusteroperators

Issues Found:
- ❌ authentication - OAuth server unreachable
- ❌ console - Pods crash-looping (126+ restarts)
- ❌ ingress - Canary checks failing

2. Root Cause Analysis

Investigation:
oc logs -n openshift-console console-xxx --previous
# Error: context deadline exceeded when initializing OAuth

DNS Issue Identified:
- Wildcard *.apps.lab.ocp.lan pointed to 192.168.22.1 (ocp-svc)
- Should point to router pods: 192.168.22.201, 192.168.22.202

3. DNS Fix

File: /etc/named/zones/db.ocp.lan

Changes:
- *.apps.lab.ocp.lan.     IN    A    192.168.22.1
+ *.apps.lab.ocp.lan.     IN    A    192.168.22.201
+ *.apps.lab.ocp.lan.     IN    A    192.168.22.202

Serial incremented: 2 → 3

Applied:
systemctl restart named
nslookup oauth-openshift.apps.lab.ocp.lan
# Returns: 192.168.22.201, 192.168.22.202 ✅

4. HAProxy Configuration for External Access

File: /etc/haproxy/haproxy.cfg

Added:
frontend console_https
    bind *:8443
    mode tcp
    default_backend console_https_backend

backend console_https_backend
    mode tcp
    balance roundrobin
    server router1 192.168.22.201:443 check
    server router2 192.168.22.202:443 check

Firewall:
firewall-cmd --zone=external --permanent --add-port=8443/tcp
firewall-cmd --reload

5. Results

Cluster Operators:
authentication    ✅ Available, not degraded
console          ✅ Available, not degraded
ingress          ✅ Available, not degraded

Console Access:
- External: https://console-openshift-console.apps.lab.ocp.lan:8443
- Requires Windows hosts file entry pointing to 192.168.1.238

Key Learnings

1. DNS is critical - Misconfigured wildcard DNS caused cascading failures
2. Ingress architecture - Router pods use HostNetwork mode on control plane nodes
3. HAProxy for external access - Bridge between external (192.168.1.x) and internal (192.168.22.x) networks
4. Troubleshooting methodology:
- Check cluster operators
- Review pod logs
- Test network connectivity
- Verify DNS resolution
- Trace the request path

Network Architecture

External Network (192.168.1.x)
        ↓
ocp-svc (192.168.1.238:8443) - HAProxy
        ↓
Internal Network (192.168.22.x)
        ↓
Router Pods (192.168.22.201:443, 192.168.22.202:443)
        ↓
Service Endpoints

Files Modified

1. /etc/named/zones/db.ocp.lan - DNS zone file
2. /etc/haproxy/haproxy.cfg - HAProxy configuration

Next Session

- Initialize Git repository for platform configurations
- Install ArgoCD for GitOps
- Create App of Apps structure
- Document ArgoCD access and usage

Commands Reference

# Check cluster health
oc get nodes
oc get co
oc get pods -A --field-selector=status.phase=Running

# DNS troubleshooting
nslookup <hostname>
dig <hostname>

# Test endpoints
curl -k https://<endpoint>/healthz

# HAProxy status
systemctl status haproxy
ss -tlnp | grep 8443

---Duration: 3 hoursStatus: ✅ Complete
